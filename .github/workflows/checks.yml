name: Checks (Lint, Test, Build)

on:
    pull_request:
    push:
        branches: ["main"]

concurrency:
    group: ${{ github.workflow }}-${{ github.event.number || github.ref }}
    cancel-in-progress: true

jobs:
    checks:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - uses: actions/setup-node@v4
              with:
                  node-version: "22.x"
                  cache: "npm"

            - run: npm ci

            - name: Run build
              run: npm run build

            - name: Check build output
              run: |
                  if [ ! -d "dist" ]; then
                    echo "Build failed: dist directory not found"
                    exit 1
                  fi
                  if [ ! -f "dist/index.js" ] || [ ! -f "dist/index.esm.js" ] || [ ! -f "dist/index.d.ts" ]; then
                    echo "Build failed: required files not found in dist"
                    exit 1
                  fi
                  echo "Build successful: all required files present"
